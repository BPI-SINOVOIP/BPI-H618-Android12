<?xml version="1.0" encoding="UTF-8"?>
<!--
    The wizard:uris recorded here have the inconvenience of being generated by hand, but they allow
    for the full spread of launch flags (we need FLAG_ACTIVITY_NEW_TASK [0x10000000]), where the
    <intent> tag processed by Intent.parseIntent() does not.

    adb shell am to-intent-uri -a com.android.setupwizard.WELCOME -f 0x10000000 \-\-ez firstRun true
-->
<WizardScript xmlns:wizard="http://schemas.android.com/apk/res/com.google.android.setupwizard"
    wizard:version="2">

    <!-- Restore apps from another device [RECOMMENDED] -->
    <!-- Check to see if we already know which device is being restored onto this one -->
    <WizardAction id="restore_check"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.CHECK_RESTORE_TOKEN;end">
        <result wizard:name="token_not_found"
            wizard:resultCode="101"
            wizard:action="restore_picker" />
        <result wizard:name="choose_what_to_restore"
            wizard:resultCode="102"
            wizard:action="choose_what_to_restore" />
        <result wizard:action="restore_start" />
    </WizardAction>

    <!-- Choose what to restore. If restore token was not provided, also choose which backup set to restore from -->
    <WizardAction id="choose_what_to_restore"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.CHOOSE_WHAT_TO_RESTORE;end">
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="date_time_check" />
        <result wizard:name="no_content"
            wizard:resultCode="2"
            wizard:action="date_time_check" />
        <result wizard:action="restore_start" />
    </WizardAction>

    <!-- Select a device to serve as the source for restored apps and start restoring -->
    <WizardAction id="restore_picker"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.RESTORE;end">
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="date_time_check" />
        <result wizard:name="no_content"
            wizard:resultCode="2"
            wizard:action="date_time_check" />
    </WizardAction>

    <WizardAction id="restore_start"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.START_RESTORE;end" />


    <!-- Start eSIM fallback setup flow when eSIM setup failed before [RECOMMENDED] -->
    <WizardAction id="esim_setup_fallback"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.ESIM_SETUP;i.setup_type=2;end" />


    <!-- Set date, time, and time zone from automated services (or manually, if needed) [RECOMMENDED, CUSTOMIZEABLE] -->
    <WizardAction id="date_time_check"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.DATE_TIME_CHECK;end">
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="save_user_name" />
    </WizardAction>

    <WizardAction id="date_time"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.DATE_TIME;end" />


    <!-- Save the user name from the account to the OS profile [RECOMMENDED, CUSTOMIZABLE] -->
    <WizardAction id="save_user_name"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.SAVE_USER_NAME;end" />


    <!-- Show service opt-ins, as well as terms of service [REQUIRED] -->
    <WizardAction id="google_services"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.GOOGLE_SERVICES;end">
        <result wizard:name="unintentional_cancel"
            wizard:resultCode="102"
            wizard:action="rollback_auth_early_update" />
        <result wizard:action="esim_setup" />
    </WizardAction>

    <!-- Script that includes steps to rollback auth early update [REQUIRED] -->
    <WizardAction id="rollback_auth_early_update"
        wizard:script="android.resource://com.allwinnertech.gmsintegration/raw/wizard_script_rollback_auth_early_update_flow">
        <result wizard:action="google_services" />
    </WizardAction>


    <!-- Start eSIM setup flow with account [RECOMMENDED] -->
    <WizardAction id="esim_setup"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.ESIM_SETUP;i.setup_type=4;end" />


    <!-- Set up biometric screen lock [RECOMMENDED, CUSTOMIZABLE] -->
    <WizardAction id="biometric"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.BIOMETRIC;end">
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="personalization_flow" />
    </WizardAction>

    <!-- Set screen lock options [RECOMMENDED, CUSTOMIZABLE] -->
    <WizardAction id="lock_screen"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOCK_SCREEN;end" />


    <!-- Common set of customization steps [RECOMMENDED] -->
    <WizardAction id="personalization_flow"
      wizard:script="android.resource://com.allwinnertech.gmsintegration/raw/wizard_script_common_personalization_flow">
        <result wizard:action="AFTER_PERSONALIZATION" />
    </WizardAction>


    <WizardAction id="AFTER_PERSONALIZATION" />


    <!-- Wait for data restoration to finish [RECOMMENDED] -->
    <WizardAction id="restore_progress"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.RESTORE_PROGRESS;end">
        <result wizard:name="retry"
            wizard:resultCode="2"
            wizard:action="restore_reset" />
        <result wizard:name="skipped"
            wizard:resultCode="102"
            wizard:action="restore_finish" />
        <result wizard:action="work_profile_setup" />
    </WizardAction>

    <!-- If data restoration failed and user chose to retry, pick a new source device [RECOMMENDED] -->
    <WizardAction id="restore_reset"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.REMOVE_RESTORE_TOKEN;end" />

    <WizardAction id="restore_retry"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.RESTORE;end">
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="final_hold" />
        <result wizard:name="no_content"
            wizard:resultCode="2"
            wizard:action="final_hold" />
    </WizardAction>

    <WizardAction id="restore_retry_start"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.START_RESTORE;end">
        <result wizard:action="restore_progress" />
    </WizardAction>

    <WizardAction id="restore_finish"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.RESTORE;B.handle_restore_errors=true;end" />


    <!-- Offer users a chance to add work profile if they had one on previous device -->
    <WizardAction id="work_profile_setup"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.WORK_PROFILE_SETUP;end">
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="final_hold" />
        <result wizard:name="no_work_profile"
            wizard:resultCode="104"
            wizard:action="final_hold" />
        <result wizard:name="add_work_profile"
            wizard:resultCode="-1"
            wizard:action="final_hold_before_work_setup" />
    </WizardAction>

    <!-- Wait for high-priority apks to be completed [RECOMMENDED] -->
    <WizardAction id="final_hold"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.FINAL_HOLD;end" >
        <result wizard:action="load_launcher_layout" />
    </WizardAction>


    <!-- Wait for high-priority apks to be completed [RECOMMENDED] -->
    <WizardAction id="final_hold_before_work_setup"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.FINAL_HOLD;B.is_work_profile_setup=true;end" />

    <WizardAction id="load_work_account_intent"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOAD_ADD_ACCOUNT_INTENT;B.showTapAndGo=false;end" />

    <WizardAction id="account_setup"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.ACCOUNT_SETUP;B.allowMultipleAccounts=true;end">
        <result wizard:name="unintentional_cancel"
            wizard:resultCode="102"
            wizard:action="work_rollback_auth_early_update" />
        <result wizard:action="load_launcher_layout" />
    </WizardAction>

    <!-- Script that includes steps to rollback auth early update [REQUIRED] -->
    <WizardAction id="work_rollback_auth_early_update"
      wizard:script="android.resource://com.allwinnertech.gmsintegration/raw/wizard_script_rollback_auth_early_update_flow">
        <result wizard:action="load_work_account_intent" />
    </WizardAction>

    <!-- Wait for launcher layout to load [RECOMMENDED] -->
    <WizardAction id="load_launcher_layout"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOAD_LAUNCHER_LAYOUT;end" />

</WizardScript>
